================================================================================
CHANGELOG - HC Tracker
================================================================================

[2026-01-15 23:16:14] - Image upload for issues and comments
--------------------------------------------------------------------------------
- Added image upload functionality
  - Upload button next to description field
  - Upload button in comment form
  - Supports JPEG, PNG, GIF, WebP (max 5MB)
  - Images stored in public/uploads folder
  - Automatically inserts markdown image syntax
- Images display in markdown preview

Files created:
- src/app/api/upload/route.ts (upload API endpoint)
- src/components/ui/ImageUpload.tsx (upload button component)
- public/uploads/ (storage directory)

Files modified:
- src/app/(dashboard)/issues/new/page.tsx (image upload for new issues)
- src/app/(dashboard)/issues/[id]/page.tsx (image upload for edit & comments)

[2026-01-15 23:04:45] - Track issue author (who created the issue)
--------------------------------------------------------------------------------
- Added authorId field to Issue model in database
- Issues now store who created them
- Issue list shows Author column
- Issue detail page shows "Created by" in header and sidebar
- Comments already show the user who wrote them

Files modified:
- prisma/schema.prisma (added authorId to Issue, createdIssues to User)
- src/types/index.ts (added author to IssueWithRelations)
- src/app/api/issues/route.ts (save authorId on create, include author)
- src/app/api/issues/[id]/route.ts (include author in response)
- src/app/(dashboard)/issues/page.tsx (Author column)
- src/app/(dashboard)/issues/[id]/page.tsx (Created by section)

[2026-01-15 23:00:23] - Make Board admin-only
--------------------------------------------------------------------------------
- Board page now requires admin access
  - Hidden from sidebar for non-admin users
  - Redirects to /issues if non-admin tries to access directly
- Login now redirects all users to /issues instead of /board

Files modified:
- src/components/layout/Sidebar.tsx (Board: adminOnly: true)
- src/app/(dashboard)/board/page.tsx (admin check + redirect)
- src/app/(auth)/login/page.tsx (redirect to /issues)

[2026-01-15 22:57:08] - Issue creation redirect & sorting fix
--------------------------------------------------------------------------------
- After creating issue, now redirects to the new issue page (not list)
- Issues sorted by GitHub ID descending (newest/highest ID first)

Files modified:
- src/app/(dashboard)/issues/new/page.tsx (redirect to /issues/{id})
- src/app/api/issues/route.ts (orderBy githubId desc)

[2026-01-15 22:50:16] - Fix tag sync to delete GitHub labels when deleted locally
--------------------------------------------------------------------------------
- Tag sync now properly handles local deletions
  - When tags are deleted locally and sync is triggered, they are removed from GitHub
  - Prevents deleted labels from being re-imported during sync
- Added deleteLabel function to GitHub API library
- Updated sync endpoint to delete GitHub labels that don't exist locally
- UI shows count of deleted labels in sync result message

Files modified:
- src/lib/github.ts (added deleteLabel function)
- src/app/api/tags/sync/route.ts (delete labels not in local)
- src/app/(dashboard)/settings/tags/page.tsx (show deleted count)

[2026-01-15 22:47:16] - Replace modals with full pages for issues
--------------------------------------------------------------------------------
- Created /issues/new page for creating issues
  - Full-page form with better mobile experience
  - Clean design with proper spacing
  - Back navigation to issues list
- Created /issues/[id] page for viewing/editing issues
  - Full-page layout with sidebar for metadata
  - Responsive design (stacked on mobile, side-by-side on desktop)
  - Comments section with markdown support
  - Edit mode for title, description, priority, tags
- Removed modal components from Board and Issues pages
  - Clicking issues now navigates to detail page
  - Create button navigates to /issues/new
- Much better UX on mobile devices

Files created:
- src/app/(dashboard)/issues/new/page.tsx
- src/app/(dashboard)/issues/[id]/page.tsx

Files modified:
- src/app/(dashboard)/board/page.tsx (simplified, no modals)
- src/app/(dashboard)/issues/page.tsx (no modals, use navigation)

[2026-01-15 22:41:47] - Make Tags management admin-only
--------------------------------------------------------------------------------
- Tags page now requires admin access
  - Hidden from sidebar for non-admin users
  - Redirects to board if non-admin tries to access directly
  - Shows "Access Denied" message before redirect
- Tags are still visible on issues for all users (read-only)

Files modified:
- src/components/layout/Sidebar.tsx (Tags: adminOnly: true)
- src/app/(dashboard)/settings/tags/page.tsx (admin check + redirect)

[2026-01-15 22:39:32] - Fix repo sync to clean up old issues
--------------------------------------------------------------------------------
- Sync now removes issues from previous/other repos
  - Deletes local issues that don't exist in current GitHub repo
  - Prevents stale data when switching repositories

Files modified:
- src/app/api/issues/route.ts (delete old issues before sync)

[2026-01-15 22:34:12] - Markdown Editor & Password Change Fix
--------------------------------------------------------------------------------
- Disabled live preview in Markdown editor (now edit-only mode)
  - Changed default preview from 'live' to 'edit'
- Fixed password change functionality
  - API now returns success flag and specific message
  - Frontend now properly shows success/error messages
  - Shows "Password updated successfully" when password changes

Files modified:
- src/components/ui/MarkdownEditor.tsx (preview = 'edit')
- src/app/api/users/me/route.ts (improved response format)
- src/app/(dashboard)/settings/page.tsx (better error handling)

[2026-01-15 22:31:48] - Issues Page Improvements & Label Sync Fix
--------------------------------------------------------------------------------
- Changed default filter to show OPEN issues (instead of all)
- Added tag filter dropdown to issues page
  - Multi-select tags to filter issues
  - Shows active filters as colored pills
  - Clear all button
  - Click outside to close dropdown
- Fixed GitHub label sync for existing issues
  - Labels from GitHub issues are now synced as tags
  - Auto-creates tags if they don't exist locally
  - Links tags to issues during sync

Files modified:
- src/stores/issueStore.ts (default filter state: 'OPEN')
- src/app/(dashboard)/issues/page.tsx (added tag filter UI)
- src/app/api/issues/route.ts (sync labels as tags)

[2026-01-15 22:28:13] - Real-Time Notification System
--------------------------------------------------------------------------------
- Added Notification model to Prisma schema
  - Supports multiple notification types: ISSUE_CREATED, ISSUE_ASSIGNED,
    ISSUE_UPDATED, ISSUE_MOVED, COMMENT_ADDED, MENTION
  - Relations to User and Issue models
  - Read/unread tracking
- Created notifications API endpoints
  - GET /api/notifications - fetch user's notifications with unread count
  - POST /api/notifications - create notifications (internal use)
  - PATCH /api/notifications - mark as read (single or all)
- Updated Header bell icon with real notifications
  - Shows unread count badge
  - Dropdown with notification list
  - Mark all as read button
  - Auto-polls every 30 seconds for new notifications
  - Click outside to close
- Notifications are created automatically on:
  - Issue creation (notifies all users except creator)
  - Issue moved between board columns (notifies all users)
  - Issue assignment (notifies assigned users)
- Created notification helper library for easy notification creation

Files created/modified:
- prisma/schema.prisma (added Notification model, NotificationType enum)
- src/lib/notifications.ts (new - helper functions)
- src/app/api/notifications/route.ts (new - API endpoints)
- src/components/layout/Header.tsx (updated with notification dropdown)
- src/app/api/issues/route.ts (added notification on create)
- src/app/api/issues/[id]/route.ts (added notifications on move/assign)

[2026-01-15 22:00:03] - User Profile Settings
--------------------------------------------------------------------------------
- Added ability for users to change their email and password
  - New API endpoint: /api/users/me (GET and PATCH)
  - Profile form in Settings page with name, email, password fields
  - Password change requires current password verification
  - Validates email uniqueness and password length (min 6 chars)

Files created/modified:
- src/app/api/users/me/route.ts (new)
- src/app/(dashboard)/settings/page.tsx (modified)

[2026-01-15 21:04:21] - Markdown Editor, Issue Details & Label Sync
--------------------------------------------------------------------------------
- Added GitHub Flavored Markdown (GFM) editor with live preview
  - Installed @uiw/react-md-editor with full GFM support
  - Created reusable MarkdownEditor component
  - Created MarkdownPreview component for rendering
- Issue Detail Modal with full functionality
  - View/edit issue title, description, priority, tags
  - Comments section with Markdown support
  - Status toggle button (Open/Closed) with instant update
  - Admin-only GitHub link
- Integrated Markdown editor into:
  - CreateIssueModal (description field)
  - IssueDetailModal (description editing & comments)
- Label/Tag sync with GitHub (bidirectional)
  - Import labels from GitHub as tags
  - Export local tags to GitHub as labels
  - Sync button on Tags settings page (Admin only)
- Admin-only visibility improvements:
  - Connections section hidden for non-admins
  - Data Sync section hidden for non-admins
  - GitHub links hidden for non-admins

Files created/modified:
- src/components/ui/MarkdownEditor.tsx (new)
- src/components/ui/MarkdownPreview.tsx (new)
- src/components/issues/IssueDetailModal.tsx (new)
- src/components/issues/CreateIssueModal.tsx (updated)
- src/app/api/issues/[id]/comments/route.ts (new)
- src/app/api/tags/sync/route.ts (new)
- src/app/(dashboard)/settings/tags/page.tsx (updated)
- src/app/(dashboard)/settings/page.tsx (updated)
- src/app/(dashboard)/board/page.tsx (updated)
- src/app/(dashboard)/issues/page.tsx (updated)

[2026-01-15 20:43:04] - GitHub Organization & Repository Selection
--------------------------------------------------------------------------------
- Added organization support for GitHub repository configuration
- Created GitHub settings page for admins to select repository
  - Lists personal repositories
  - Lists all organizations the user belongs to
  - Allows switching between personal and org repos
  - Shows current active repository selection
  - One-click repository selection with visual feedback
- Extended GitHub API integration:
  - listUserRepos() - fetch authenticated user's repositories
  - listOrgRepos(org) - fetch organization repositories
  - listOrgs() - list organizations user belongs to
  - saveRepoConfig() - persist selected repo to database
  - getRepoConfig() - retrieve config from DB with env fallback
- Added Setting model usage for storing github_repo configuration
- Added GitHub nav link to Sidebar (admin-only)

Files created/modified:
- src/lib/github.ts (extended with org methods)
- src/app/api/github/repos/route.ts (new - GET/POST for repo selection)
- src/app/(dashboard)/settings/github/page.tsx (new - repository selector UI)
- src/components/layout/Sidebar.tsx (added GitHub nav link)

[2026-01-15 20:27:06] - Initial Project Setup Complete
--------------------------------------------------------------------------------
- Created Next.js 16 project with TypeScript and Tailwind CSS
- Configured Docker Compose with MySQL (port 4030) and App (port 4029)
- Implemented Prisma ORM with MySQL database schema:
  - User model with role-based access (ADMIN, MANAGER, MEMBER, VIEWER)
  - Custom Tag system with categories and colors
  - Group system for team organization
  - Issue model linked to GitHub Issues
  - Activity logging for audit trail
  - Board columns for Kanban workflow
- Implemented independent authentication system:
  - NextAuth.js with credentials provider
  - JWT-based sessions (7 days)
  - Registration and login pages
  - Password hashing with bcrypt
- Created GitHub API integration layer:
  - Central token configuration (server-side)
  - Issue CRUD operations synced with GitHub
  - Comment management
  - Label management
- Built Dashboard UI (Jira-style):
  - Kanban board with drag-and-drop (5 columns: Backlog, To Do, In Progress, Review, Done)
  - Issue list view with filters
  - Issue cards showing priority, tags, assignees
  - Create issue modal
- Implemented Tags and Groups management:
  - Tags settings page with color picker
  - Groups settings page
  - API endpoints for CRUD operations
- Added health check endpoints for GitHub and Database connections
- Created seed script for default data (admin user, tags, groups, board columns)

Files created:
- docker-compose.yml, Dockerfile
- prisma/schema.prisma, prisma/seed.ts
- src/lib/prisma.ts, src/lib/github.ts, src/lib/auth.ts
- src/stores/issueStore.ts
- src/components/layout/Sidebar.tsx, Header.tsx
- src/components/board/KanbanBoard.tsx, IssueCard.tsx
- src/components/issues/CreateIssueModal.tsx
- src/app/(auth)/login/page.tsx, register/page.tsx
- src/app/(dashboard)/board/page.tsx, issues/page.tsx, settings/page.tsx
- src/app/(dashboard)/settings/tags/page.tsx, groups/page.tsx
- src/app/api/auth/[...nextauth]/route.ts, register/route.ts
- src/app/api/issues/route.ts, [id]/route.ts
- src/app/api/tags/route.ts, [id]/route.ts
- src/app/api/groups/route.ts, [id]/route.ts
- src/app/api/health/github/route.ts, db/route.ts

================================================================================
